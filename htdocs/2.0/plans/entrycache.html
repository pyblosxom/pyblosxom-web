<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.5: http://docutils.sourceforge.net/" />
<title>Entry-level caching</title>
<meta name="author" content="Will Guaraldi &lt;will dot guaraldi at gmail dot com&gt;" />
<link rel="stylesheet" href="manual_style.css" type="text/css" />
</head>
<body>
<div class="document" id="entry-level-caching">
<h1 class="title">Entry-level caching</h1>
<table class="docinfo" frame="void" rules="none">
<col class="docinfo-name" />
<col class="docinfo-content" />
<tbody valign="top">
<tr><th class="docinfo-name">Author:</th>
<td>Will Guaraldi &lt;will dot guaraldi at gmail dot com&gt;</td></tr>
<tr class="field"><th class="docinfo-name">Originally published:</th><td class="field-body">August 28, 2007</td>
</tr>
<tr class="field"><th class="docinfo-name">URL:</th><td class="field-body"><a class="reference external" href="http://pyblosxom.sourceforge.net/2.0/plans/entrycache.html">http://pyblosxom.sourceforge.net/2.0/plans/entrycache.html</a></td>
</tr>
</tbody>
</table>
<div class="section" id="history">
<h1>History</h1>
<p>August 30, 2007 - Will Guaraldi</p>
<blockquote>
<ul class="simple">
<li>Updated the document based on conversation on pyblosxom-devel and
posts from Asheesh, drear, and Ryan.</li>
<li>Added Changes section.</li>
<li>Added urls for archived discussion.</li>
</ul>
</blockquote>
<p>August 28, 2007 - Will Guaraldi</p>
<blockquote>
<ul class="simple">
<li>Wrote the initial document, emailed it to pyblosxom-devel.</li>
</ul>
</blockquote>
</div>
<div class="section" id="summary">
<h1>Summary</h1>
<p>In previous versions of PyBlosxom, entry level caching was handled
by the <tt class="docutils literal"><span class="pre">Pyblosxom.cache</span></tt>  package particularly the <tt class="docutils literal"><span class="pre">entryshelve</span></tt>
and <tt class="docutils literal"><span class="pre">entrypickle</span></tt> cache drivers.  The cache drivers tie into the
entry system through the <tt class="docutils literal"><span class="pre">getFromCache</span></tt> and <tt class="docutils literal"><span class="pre">addToCache</span></tt> methods
in <tt class="docutils literal"><span class="pre">Pyblosxom.entries.base</span></tt>.</p>
<p>When there is no cache driver, <tt class="docutils literal"><span class="pre">getFromCache</span></tt> finds the <tt class="docutils literal"><span class="pre">cacheDriver</span></tt>,
calls <tt class="docutils literal"><span class="pre">get</span></tt> on it, that kicks up an exception, and then <tt class="docutils literal"><span class="pre">getFromCache</span></tt>
returns <tt class="docutils literal"><span class="pre">None</span></tt> which causes entry objects to retrieve the information
on their own.</p>
<p>As I see it, the problem with this architecture is three fold:</p>
<ol class="arabic simple">
<li>not having a cache driver enabled is more expensive than it should be</li>
<li>entry-level caching code is part of PyBlosxom core, but should be
done as plugins</li>
<li>you only get to use one cache driver</li>
</ol>
</div>
<div class="section" id="proposed-design">
<h1>Proposed design</h1>
<p>Remove caching code from PyBlosxom codebase.</p>
<p>Add two entry-cache related callbacks:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">entrycache_get</span></tt> -
This retrieves items from the cache given an entryid.  Since this is a
callback, if one entry cache handling plugin can't handle the request,
it gets passed on to another.  This would allow for multiple levels of
caching.</li>
<li><tt class="docutils literal"><span class="pre">entrycache_update</span></tt> -
This updates items in the cache given an entryid.  Since this is a callback,
<strong>all</strong> entry cache handling plugins are notified of the update.</li>
</ul>
<p>When entry data is required, we follow the following process to retrieve it:</p>
<ol class="arabic simple">
<li>Call <tt class="docutils literal"><span class="pre">entrycache_get</span></tt> passing in the entryid and the request.<ul>
<li>If this returns an entry dict, we use that.</li>
<li>If this returns <tt class="docutils literal"><span class="pre">None</span></tt>, we parse the entry.</li>
</ul>
</li>
<li>Do stuff with the entry data....</li>
<li>Call <tt class="docutils literal"><span class="pre">entrycache_update</span></tt> passing in the entryid, request, and the entry dict.</li>
</ol>
<p>Reimplement the two caching drivers as plugins that implement the <tt class="docutils literal"><span class="pre">entrycache_*</span></tt>
callbacks.</p>
</div>
<div class="section" id="outstanding-issues">
<h1>Outstanding issues</h1>
<ol class="arabic">
<li><p class="first"><em>If a user wants to use multiple entrycache plugins at the same time and the
order in which these plugins execute is an issue, how does the user specify
the order in which the plugins execute?</em></p>
<p>The user can use <tt class="docutils literal"><span class="pre">load_plugins</span></tt> which allows the user to specify which plugins
are loaded and in which order.  The order the plugins are loaded corresponds to
the order in which the plugins are executed during callbacks.</p>
<p>If there's a situation where using <tt class="docutils literal"><span class="pre">load_plugins</span></tt> doesn't work, we can
work out an alternate solution then.</p>
</li>
</ol>
</div>
<div class="section" id="discussion">
<h1>Discussion</h1>
<p>Discussion of this proposal is at:</p>
<dl class="docutils">
<dt>gmane.org</dt>
<dd><a class="reference external" href="http://news.gmane.org/gmane.comp.web.pyblosxom.devel">http://news.gmane.org/gmane.comp.web.pyblosxom.devel</a></dd>
<dt>sf.net</dt>
<dd><a class="reference external" href="http://sourceforge.net/mailarchive/forum.php?thread_name=185aeadc0708280759j16495b14o785eabef91920e25%40mail.gmail.com&amp;forum_name=pyblosxom-devel">http://sourceforge.net/mailarchive/forum.php?thread_name=185aeadc0708280759j16495b14o785eabef91920e25%40mail.gmail.com&amp;forum_name=pyblosxom-devel</a></dd>
</dl>
</div>
</div>
<div class="footer">
<hr class="footer" />
<a class="reference external" href="entrycache.txt">View document source</a>.
Generated on: 2007-10-31 18:17 UTC.
Generated by <a class="reference external" href="http://docutils.sourceforge.net/">Docutils</a> from <a class="reference external" href="http://docutils.sourceforge.net/rst.html">reStructuredText</a> source.

</div>
</body>
</html>
