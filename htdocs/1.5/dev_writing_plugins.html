<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Writing Plugins &mdash; PyBlosxom 1.5.2 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.5.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="PyBlosxom 1.5.2 documentation" href="index.html" />
    <link rel="next" title="Code Documentation" href="dev_codedocs.html" />
    <link rel="prev" title="Pyblosxom Architecture" href="dev_architecture.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="dev_codedocs.html" title="Code Documentation"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="dev_architecture.html" title="Pyblosxom Architecture"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">PyBlosxom 1.5.2 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="writing-plugins">
<span id="id1"></span><h1>Writing Plugins<a class="headerlink" href="#writing-plugins" title="Permalink to this headline">¶</a></h1>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>This chapter covers a bunch of useful things to know when writing
Pyblosxom plugins.  This chapter, moreso than the rest of this manual,
is very much a work in progress.</p>
<p>If you need help with plugin development, sign up on the devel mailing
list and/or join us on <tt class="docutils literal"><span class="pre">#pyblosxom</span></tt> on <tt class="docutils literal"><span class="pre">irc.freenode.net</span></tt>.  More
details in <a class="reference internal" href="about_pyblosxom.html#project-details-and-contact"><em>Project details, contact information, and where to go for help</em></a>.</p>
<p>FIXME - this needs more work</p>
</div>
<div class="section" id="things-that-all-plugins-should-have">
<h2>Things that all plugins should have<a class="headerlink" href="#things-that-all-plugins-should-have" title="Permalink to this headline">¶</a></h2>
<p>This section covers things that all plugins should have.  This makes
plugins easier to distribute, maintain, update, and easier for users
to use them.</p>
<div class="section" id="name">
<h3>Name<a class="headerlink" href="#name" title="Permalink to this headline">¶</a></h3>
<p>All plugins need a good name that&#8217;s unique so that your plugin doesn&#8217;t get
confused with other plugins.  Additionally, the filename for your plugin
needs to be unique.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Make sure the filename for your plugin is unique!  Pyblosxom imports your
plugin using Python import machinery which means that if your plugin has
the same name as a package on your system, then depending on how sys.path
is set up, Pyblosxom may load the package on your system and NOT your
plugin.</p>
<p class="last">If you think this might be happening to you, do <tt class="docutils literal"><span class="pre">pyblosxom-cmd</span> <span class="pre">test</span></tt> and
it&#8217;ll tell you the paths of what it&#8217;s loading.</p>
</div>
</div>
<div class="section" id="documentation">
<h3>Documentation<a class="headerlink" href="#documentation" title="Permalink to this headline">¶</a></h3>
<p>All plugins should have a docstring at the top of the file that describes
in detail:</p>
<ol class="arabic simple">
<li>what the plugin does</li>
<li>how to install it</li>
<li>how to configure it</li>
<li>the license the plugin is distributed under</li>
<li>and any copyright information you have</li>
<li>any notes about requirements (e.g. &#8220;Requires Python 2.3 or greater&#8221;)</li>
</ol>
<p>For example, this is at the top of Will&#8217;s wbgpager plugin:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83</pre></div></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Quickly written plugin for paging long index pages.</span>

<span class="sd">Pyblosxom uses the num_entries configuration variable to prevent</span>
<span class="sd">more than num_entries being rendered by cutting the list down</span>
<span class="sd">to num_entries entries.  So if your num_entries is set to 20, you</span>
<span class="sd">will only see the first 20 entries rendered.</span>

<span class="sd">The wbgpager overrides this functionality and allows for paging.</span>
<span class="sd">It does some dirty stuff so that Pyblosxom doesn&#39;t cut the list down</span>
<span class="sd">and then wbgpager cuts it down in the prepare callback later down</span>
<span class="sd">the line.</span>

<span class="sd">To install wbgpager, do the following:</span>

<span class="sd">  1. add &quot;wbgpager&quot; to your load_plugins list variable in your</span>
<span class="sd">     config.py file---make sure it&#39;s the first thing listed so</span>
<span class="sd">     that it has a chance to operate on the entry list before</span>
<span class="sd">     other plugins.</span>
<span class="sd">  2. add the $page_navigation variable to your head or foot</span>
<span class="sd">     (or both) templates.  this is where the page navigation</span>
<span class="sd">     HTML will appear.</span>


<span class="sd">Here are some additional configuration variables to adjust the</span>
<span class="sd">behavior:</span>

<span class="sd">  wbgpager_count_from</span>
<span class="sd">    datatype:       int</span>
<span class="sd">    default value:  0</span>
<span class="sd">    description:    Some folks like their paging to start at 1---this</span>
<span class="sd">                    enables you to do that.</span>

<span class="sd">  wbgpager_previous_text</span>
<span class="sd">    datatype:       string</span>
<span class="sd">    default value:  &amp;lt;&amp;lt;</span>
<span class="sd">    description:    Allows you to change the text for the prev link.</span>

<span class="sd">  wbgpager_next_text</span>
<span class="sd">    datatype:       string</span>
<span class="sd">    default value:  &amp;gt;&amp;gt;</span>
<span class="sd">    description:    Allows you to change the text for the next link.</span>

<span class="sd">  wbgpager_linkstyle</span>
<span class="sd">    datatype:       integer</span>
<span class="sd">    default value:  0</span>
<span class="sd">    description:    This allows you to change the link style of the paging.</span>
<span class="sd">                    style 0:  [1] 2 3 4 5 6 7 8 9 ... &gt;&gt;</span>
<span class="sd">                    style 1:  Page 1 of 4 &gt;&gt;</span>


<span class="sd">That should be it!</span>


<span class="sd">Note: This plugin doesn&#39;t work particularly well with static rendering.</span>
<span class="sd">The problem is that it relies on the querystring to figure out which</span>
<span class="sd">page to show and when you&#39;re static rendering, only the first page</span>
<span class="sd">is rendered.  This will require a lot of thought to fix.  If you are</span>
<span class="sd">someone who is passionate about fixing this issue, let me know.</span>


<span class="sd">Permission is hereby granted, free of charge, to any person</span>
<span class="sd">obtaining a copy of this software and associated documentation</span>
<span class="sd">files (the &quot;Software&quot;), to deal in the Software without restriction,</span>
<span class="sd">including without limitation the rights to use, copy, modify,</span>
<span class="sd">merge, publish, distribute, sublicense, and/or sell copies of the</span>
<span class="sd">Software, and to permit persons to whom the Software is furnished</span>
<span class="sd">to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be</span>
<span class="sd">included in all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,</span>
<span class="sd">EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES</span>
<span class="sd">OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND</span>
<span class="sd">NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS</span>
<span class="sd">BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN</span>
<span class="sd">ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN</span>
<span class="sd">CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span>
<span class="sd">SOFTWARE.</span>

<span class="sd">Copyright 2004, 2005, 2006 Will Kahn-Greene</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="metadata">
<h3>Metadata<a class="headerlink" href="#metadata" title="Permalink to this headline">¶</a></h3>
<p>All plugins should have the following module-level variables
defined in them just after the docstring:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">__author__</span></tt> - This holds your name and email address
so that people can contact you when they have problems.</li>
<li><tt class="docutils literal"><span class="pre">__version__</span></tt> - This holds the version number and release
date so that people know what version of the plugin they&#8217;re looking
at.</li>
<li><tt class="docutils literal"><span class="pre">__url__</span></tt> - This holds the url where people can find information
about your plugin and documentation and download new versions of your
plugin.</li>
<li><tt class="docutils literal"><span class="pre">__description__</span></tt> - This is a one-sentence description of what your
plugin does.</li>
</ul>
<p>For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">__author__</span>      <span class="o">=</span> <span class="s">&quot;Will Kahn-Greene - willg at bluesock dot org&quot;</span>
<span class="n">__version__</span>     <span class="o">=</span> <span class="s">&quot;version 1.5 2006-01-15&quot;</span>
<span class="n">__url__</span>         <span class="o">=</span> <span class="s">&quot;http://www.bluesock.org/~willg/pyblosxom/&quot;</span>
<span class="n">__description__</span> <span class="o">=</span> <span class="s">&quot;Splits long indexes into multiple pages.&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="configuration-installation-and-verification">
<h3>Configuration, installation and verification<a class="headerlink" href="#configuration-installation-and-verification" title="Permalink to this headline">¶</a></h3>
<p>After that, you should have a <tt class="docutils literal"><span class="pre">verify_installation</span></tt> section that
verifies that the plugin is configured correctly.  As of Pyblosxom 0.9,
Pyblosxom allows users to test their configuration and installation from
the console.</p>
<p>You can test using either the <tt class="docutils literal"><span class="pre">pyblosxom.cgi</span></tt>
script or the <tt class="docutils literal"><span class="pre">pyblosxom-cmd</span></tt> script:</p>
<div class="highlight-python"><pre>% ./pyblosxom.cgi test</pre>
</div>
<p>or:</p>
<div class="highlight-python"><pre>$ ./pyblcmd_dev.sh test --config ./newblog/
pyblosxom-cmd version 1.5 dev
Adding ./newblog/ to sys.path....
Trying to import the config module....
System Information
==================

- pyblosxom:    1.5 dev
- sys.version:  2.6.4 (r264:75706, Dec  7 2009, 18:45:15)  [GCC 4.4.1]
- os.name:      posix
- codebase:     /home/willg/projects/pyblosxom/trunk/pyblosxom

Checking config.py file
=======================
- properties set: 21
- datadir '/home/willg/projects/pyblosxom/testing/newblog/entries' exists.

Checking plugin configuration
=============================
....</pre>
</div>
<p>This goes through and verifies the properties in the <tt class="docutils literal"><span class="pre">config.py</span></tt>
file as best as it can.  It also prints out diagnostic information
which is useful when things don&#8217;t work.  It also loads and initializes
all the plugins and asks them to verify their configurations as best
they can.</p>
<p>As a plugin developer, you should add a <tt class="docutils literal"><span class="pre">verify_installation</span></tt>
function to your plugin module.  Something like this (taken from
pycategories):</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">verify_installation</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_configuration</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">config</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&quot;category_flavour&quot;</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;missing optional config property &#39;category_flavour&#39; &quot;</span>
        <span class="k">print</span> <span class="s">&quot;which allows you to specify the flavour for the category &quot;</span>
        <span class="k">print</span> <span class="s">&quot;link.  refer to pycategory plugin documentation for more &quot;</span>
        <span class="k">print</span> <span class="s">&quot;details.&quot;</span>
    <span class="k">return</span> <span class="mi">1</span>
</pre></div>
</td></tr></table></div>
<p>This gives you (the plugin developer) the opportunity to walk the user
through configuring your highly complex, quantum-charged, turbo plugin
in small baby steps without having to hunt for where their logs might
be.</p>
<p>So check the things you need to check, print out error messages
(informative ones) using <tt class="docutils literal"><span class="pre">print</span></tt>, and then return a 1 if the plugin
is configured correctly or a 0 if it&#8217;s not configured correctly.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is not a substitute for the user to read the installation
instructions.  It should be a really easy way to catch a lot of
potential problems without involving the web server&#8217;s error logs and
debugging information being sent to a web-browser and things of that
nature.</p>
</div>
<p>Here&#8217;s an example of <tt class="docutils literal"><span class="pre">verify_installation</span></tt> from Will&#8217;s wbgpager
plugin:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">verify_installation</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_configuration</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;num_entries&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;missing config property &#39;num_entries&#39;.  wbgpager won&#39;t do &quot;</span>
        <span class="k">print</span> <span class="s">&quot;anything without num_entries set.  either set num_entries &quot;</span>
        <span class="k">print</span> <span class="s">&quot;to a positive integer, or disable the wbgpager plugin.&quot;</span>
        <span class="k">print</span> <span class="s">&quot;see the documentation at the top of the wbgpager plugin &quot;</span>
        <span class="k">print</span> <span class="s">&quot;code file for more details.&quot;</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="mi">1</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="how-to-log-messages-to-a-log-file">
<h2>How to log messages to a log file<a class="headerlink" href="#how-to-log-messages-to-a-log-file" title="Permalink to this headline">¶</a></h2>
<p>First you need to get the logger instance.  After that, you can call
debug, info, warning, error and critical on the logger instance.  For
example:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pyblosxom</span> <span class="kn">import</span> <span class="n">tools</span>

<span class="k">def</span> <span class="nf">cb_prepare</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="c"># ...</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;blah blah blah...&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">pass</span>
        <span class="c"># ...</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="how-to-store-plugin-state-between-callbacks">
<h2>How to store plugin state between callbacks<a class="headerlink" href="#how-to-store-plugin-state-between-callbacks" title="Permalink to this headline">¶</a></h2>
<p>The easiest way to store state between callbacks is to store the data
in the data dict of the Request object.  For example:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span class="n">STATE_KEY</span> <span class="o">=</span> <span class="s">&quot;myplugin_state&quot;</span>

<span class="k">def</span> <span class="nf">cb_date_head</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="n">request</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s">&quot;request&quot;</span><span class="p">]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>

    <span class="k">if</span> <span class="p">((</span><span class="n">data</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">STATE_KEY</span><span class="p">)</span>
         <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="n">STATE_KEY</span><span class="p">][</span><span class="s">&quot;blah&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;blahblah&quot;</span><span class="p">)):</span>
        <span class="k">pass</span>
        <span class="c"># ...</span>


<span class="k">def</span> <span class="nf">cb_filelist</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="n">request</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s">&quot;request&quot;</span><span class="p">]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>

    <span class="n">data</span><span class="p">[</span><span class="n">STATE_KEY</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">data</span><span class="p">[</span><span class="n">STATE_KEY</span><span class="p">][</span><span class="s">&quot;blah&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;blahblah&quot;</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="how-to-implement-a-callback">
<h2>How to implement a callback<a class="headerlink" href="#how-to-implement-a-callback" title="Permalink to this headline">¶</a></h2>
<p>If you want to implement a callback, you add a function corresponding
to the callback name to your plugin module.  For example, if you
wanted to modify the Request object just before rendering, you&#8217;d
implement <tt class="docutils literal"><span class="pre">cb_prepare</span></tt> like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">cb_prepare</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>Obviously, since we have <tt class="docutils literal"><span class="pre">pass</span></tt> we&#8217;re not actually doing anything
here, but when the user sends a request and Pyblosxom handles it, this
function in your plugin will get called when Pyblosxom runs the
prepare callback.</p>
<p>Each callback passes in arguments through a single dictionary.  Each
callback passes in different arguments and expects different return
values.  Check the doc:<cite>dev_architecture &lt;architecture&gt;</cite> chapter
for a list of all the callbacks that are available, their arguments,
and return values.</p>
</div>
<div class="section" id="writing-an-entryparser">
<span id="id2"></span><h2>Writing an entryparser<a class="headerlink" href="#writing-an-entryparser" title="Permalink to this headline">¶</a></h2>
<p>Entry parsing functions take in a filename and the Request object.
They then open the file and parse it out.  They can call
<tt class="docutils literal"><span class="pre">cb_preformat</span></tt> and <tt class="docutils literal"><span class="pre">cb_postformat</span></tt> as they see fit.  They should
return a dict containing at least <tt class="docutils literal"><span class="pre">&quot;title&quot;</span></tt> and <tt class="docutils literal"><span class="pre">&quot;body&quot;</span></tt> keys.
The &#8220;title&#8221; should be a single string.  The <tt class="docutils literal"><span class="pre">&quot;body&quot;</span></tt> should be a
single string and should be formatted in HTML.</p>
<p>Here&#8217;s an example code that reads <tt class="docutils literal"><span class="pre">.plain</span></tt> files which have the
title as the first line, metadata lines that start with <tt class="docutils literal"><span class="pre">#</span></tt> and then
after all the metadata the body of the entry:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">os</span>

<span class="k">def</span> <span class="nf">cb_entryparser</span><span class="p">(</span><span class="n">entryparsingdict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Register self as plain file handler</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">entryparsingdict</span><span class="p">[</span><span class="s">&quot;plain&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parse</span>
    <span class="k">return</span> <span class="n">entryparsingdict</span>

<span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    We just read everything off the file here, using the filename</span>
<span class="sd">    as the title.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">entrydata</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">entrydata</span><span class="p">[</span><span class="s">&quot;title&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename</span>
    <span class="n">entrydata</span><span class="p">[</span><span class="s">&quot;body&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;&lt;pre&gt;&quot;</span> <span class="o">+</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;&lt;/pre&gt;&quot;</span>

    <span class="k">return</span> <span class="n">entrydata</span>
</pre></div>
</td></tr></table></div>
<p>You can also specify the template to use by setting the
<tt class="docutils literal"><span class="pre">&quot;template_name&quot;</span></tt> variable in the returned dict.  If the template
specified doesn&#8217;t exist, Pyblosxom will use the <tt class="docutils literal"><span class="pre">story</span></tt> template for
the specified flavour.</p>
<p>For example, if you were creating a tumblelog and the file parsed was
a image entry and you want image entries to be displayed on your blog
with an image and then a caption below it and that&#8217;s it, then you
would create a template for that and set <tt class="docutils literal"><span class="pre">&quot;template_name&quot;</span></tt> to the
name of the template:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">cb_entryparser</span><span class="p">(</span><span class="n">entryparsingdict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Register self as plain file handler</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">entryparsingdict</span><span class="p">[</span><span class="s">&#39;image&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parse_image</span>
    <span class="k">return</span> <span class="n">entryparsingdict</span>

<span class="k">def</span> <span class="nf">parse_image</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An image entry consists of an image file name followed by</span>
<span class="sd">    the caption.  Like this::</span>

<span class="sd">        cimg_8229.jpg</span>
<span class="sd">        This is a picture of me standing on my head.</span>

<span class="sd">    Note that there&#39;s no title, no metadata, ...</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">entrydata</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c"># we do this for RSS purposes</span>
    <span class="n">entrydata</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;image </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">entrydata</span><span class="p">[</span><span class="s">&#39;body&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
        <span class="s">&quot;&lt;img src=</span><span class="se">\&quot;</span><span class="s">/images/</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s">&gt;&quot;</span><span class="p">,</span>
        <span class="s">&quot;&lt;p&gt;</span><span class="si">%s</span><span class="s">&lt;/p&gt;&quot;</span> <span class="o">%</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="p">])</span>

    <span class="n">entrydata</span><span class="p">[</span><span class="s">&quot;template_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;image_post&quot;</span>

    <span class="k">return</span> <span class="n">entrydata</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="writing-a-preformatter-plugin">
<span id="writing-a-preformatter"></span><h2>Writing a preformatter plugin<a class="headerlink" href="#writing-a-preformatter-plugin" title="Permalink to this headline">¶</a></h2>
<p>FIXME - need more about preformatters here</p>
<p>A typical preformatter plugin looks like this:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">cb_preformat</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="s">&#39;parser&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;linebreaks&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">parse</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s">&#39;story&#39;</span><span class="p">]))</span>

<span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="c"># A preformatter to convert linebreak to its HTML counterpart</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">n</span><span class="se">\\</span><span class="s">n+&#39;</span><span class="p">,</span><span class="s">&#39;&lt;/p&gt;&lt;p&gt;&#39;</span><span class="p">,</span><span class="n">text</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">n&#39;</span><span class="p">,</span><span class="s">&#39;&lt;br /&gt;&#39;</span><span class="p">,</span><span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">&#39;&lt;p&gt;</span><span class="si">%s</span><span class="s">&lt;/p&gt;&#39;</span> <span class="o">%</span> <span class="n">text</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="writing-a-postformatter-plugin">
<span id="writing-a-postformatter"></span><h2>Writing a postformatter plugin<a class="headerlink" href="#writing-a-postformatter-plugin" title="Permalink to this headline">¶</a></h2>
<p>FIXME - write this section</p>
</div>
<div class="section" id="writing-a-renderer">
<span id="id3"></span><h2>Writing a renderer<a class="headerlink" href="#writing-a-renderer" title="Permalink to this headline">¶</a></h2>
<p>FIXME - write this section</p>
</div>
<div class="section" id="writing-a-plugin-that-adds-a-commandline-command">
<span id="writing-a-command"></span><h2>Writing a plugin that adds a commandline command<a class="headerlink" href="#writing-a-plugin-that-adds-a-commandline-command" title="Permalink to this headline">¶</a></h2>
<p><em>New in Pyblosxom 1.5</em></p>
<p>The <tt class="docutils literal"><span class="pre">pyblosxom-cmd</span></tt> command allows for plugin-defined commands.
This allows your plugin to do maintenance tasks (updating an index,
statistics, generating content, ...) and allows the user to schedule
command execution through cron or some similar system.</p>
<p>To write a new command, you must:</p>
<ol class="arabic simple">
<li>implement the <tt class="docutils literal"><span class="pre">commandline</span></tt> callback which adds the command,
handler, and command summary</li>
<li>implement the command function</li>
</ol>
<p>For example, this adds a command to print command line arguments:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">printargs</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">argv</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">argv</span>
    <span class="k">return</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">cb_commandline</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="n">args</span><span class="p">[</span><span class="s">&quot;printargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">printargs</span><span class="p">,</span> <span class="s">&quot;prints arguments&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">args</span>
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The plugin must be in a directory specified by <tt class="docutils literal"><span class="pre">load_plugins</span></tt> in
the user&#8217;s <tt class="docutils literal"><span class="pre">config.py</span></tt> file.</p>
</div>
<p>Executing the command looks like this:</p>
<div class="highlight-python"><pre>% pyblosxom-cmd printargs --config /path/to/config.py/dir a b c
pyblosxom-cmd version 1.5
a b c</pre>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Writing Plugins</a><ul>
<li><a class="reference internal" href="#summary">Summary</a></li>
<li><a class="reference internal" href="#things-that-all-plugins-should-have">Things that all plugins should have</a><ul>
<li><a class="reference internal" href="#name">Name</a></li>
<li><a class="reference internal" href="#documentation">Documentation</a></li>
<li><a class="reference internal" href="#metadata">Metadata</a></li>
<li><a class="reference internal" href="#configuration-installation-and-verification">Configuration, installation and verification</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-log-messages-to-a-log-file">How to log messages to a log file</a></li>
<li><a class="reference internal" href="#how-to-store-plugin-state-between-callbacks">How to store plugin state between callbacks</a></li>
<li><a class="reference internal" href="#how-to-implement-a-callback">How to implement a callback</a></li>
<li><a class="reference internal" href="#writing-an-entryparser">Writing an entryparser</a></li>
<li><a class="reference internal" href="#writing-a-preformatter-plugin">Writing a preformatter plugin</a></li>
<li><a class="reference internal" href="#writing-a-postformatter-plugin">Writing a postformatter plugin</a></li>
<li><a class="reference internal" href="#writing-a-renderer">Writing a renderer</a></li>
<li><a class="reference internal" href="#writing-a-plugin-that-adds-a-commandline-command">Writing a plugin that adds a commandline command</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="dev_architecture.html"
                        title="previous chapter">Pyblosxom Architecture</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="dev_codedocs.html"
                        title="next chapter">Code Documentation</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/dev_writing_plugins.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="dev_codedocs.html" title="Code Documentation"
             >next</a> |</li>
        <li class="right" >
          <a href="dev_architecture.html" title="Pyblosxom Architecture"
             >previous</a> |</li>
        <li><a href="index.html">PyBlosxom 1.5.2 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright Creative Commons CC0 - http://creativecommons.org/publicdomain/zero/1.0/.
      Last updated on Jul 31, 2013.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>